#!/usr/bin/env node

var forever = require('./../lib/forever');

if (process.send) {
  //
  // Supress `stdout` and `stderr` when `forever` is being run as a fork.
  // We use `child_process.fork` to daemonize `forever` processes, so
  // outputting anything isn't a desired situation.
  //
  var nullStream = fs.createWriteStream('/dev/null');
  var returner = function () {
    return nullStream;
  };
  process.__defineGetter__('stdout', returner);
  process.__defineGetter__('stderr', returner);
}

var worker = new forever.Worker();

worker.on('start', function () {
  return process.send 
    ? process.send({ sockPath: worker._sockFile })
    : process.stdout.write(worker._sockFile);
});

worker.start();